# システム inbox とリレーサーバー仕様

このドキュメントでは、takos が提供するシステム用 inbox の取り扱いと、
デフォルトリレーサーバー `takos.jp` との連携方針をまとめます。

## ユーザードメインのシステム inbox

- `*.takos.jp` など利用者ごとのドメインには、コードに埋め込み済みの `system`
  アクターを使用します。
- そのドメイン宛てに届いた ActivityPub オブジェクトは、該当ユーザーに
  表示します。ユーザーが存在しない場合でも `object_store` に保存します。

## takos.jp のシステム inbox

- takos 本体 (例: `takos.jp`) の `system` inbox に届いたオブジェクトは、
  デフォルトリレーサーバー `takos.jp` が取得できるよう公開します。
- これにより各インスタンスはリレーを経由して takos 全体の通知を受け取れます。
  利用するリレー先は takos host 側の `DEFAULT_RELAY` で指定できます。

## リレーサーバーの公開設定

- `takos.jp` は公開アクセス可能ですが、初期状態では外部への `Follow`
  送信や外部からの `Follow` を受け付けません。
- フォローを許可する場合は管理者が明示的に設定を変更します。
- `takos.jp` 利用者同士の ActivityPub 通信は、DB
  操作のみで完結させ、ネットワーク通信を行いません。
